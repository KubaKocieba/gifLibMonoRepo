<mat-card>
  <mat-card-header>Upload a file & convert it to gif</mat-card-header>
  <mat-card-content>
    <form [formGroup]="imageUploadForm" enctype="multipart/form-data">
      <input type="file" accept="video/*" (change)="onFileInputChange($event)" class="HiddenFileInput" #fileInput />
      <button mat-button type="button" (click)="fileInput.click()">
        <div><mat-icon>add_circle_outline</mat-icon></div>
        <div><mat-label>Add a new video</mat-label></div>
      </button>
      <mat-error>
        {{ imageUploadForm.errors }}
      </mat-error>

      <div class="UploadedAndConverted">
        <div class="ImagePreview" [hidden]="!(loadedVideo$ | async)">
          <h1>
            Video file name: <span class="ImageName">{{ uploadedFile?.name }}</span>
          </h1>
          <div class="videoplayer">
            <video
              loop
              [muted]="true"
              autoplay
              width="150px"
              height="auto"
              #convertedVideo
              [src]="videoURL"
              (loadeddata)="videoLoaded(convertedVideo.videoWidth, convertedVideo.videoHeight, $event)"
            ></video>
            <!--<mat-video [muted]="true"-->
            <!--[overlay]="false"-->
            <!--spinner="dotted"-->
            <!--[preload]="true"-->
            <!--[src]="videoURL"-->
            <!--[loop]="true"-->
            <!--[autoplay]="true" #convertedVideo>-->
            <!--</mat-video>-->
          </div>
          <div *ngIf="(loadedVideo$ | async)">
            <h2><label>Size:</label> {{ fileSizeInKB }} KB ({{ fileSizeInMB }} MB)</h2>
            <h2>
              <label>Resolution: </label><span>{{ originalResolution }} </span>
            </h2>
            <h2><label>Type:</label> {{ uploadedFile.type.split('/')[1] }}</h2>
            <div>
              <div>Select resolution:</div>
              <mat-button-toggle-group
                *ngIf="resolutions"
                #group="matButtonToggleGroup"
                formControlName="resolution"
                [value]="originalResolution"
                (change)="resolutionChange(group.value)"
              >
                <mat-button-toggle [value]="originalResolution">Original: ({{ originalResolution }})</mat-button-toggle>
                <mat-button-toggle *ngFor="let res of resolutions" [value]="res">
                  {{ res }}
                </mat-button-toggle>
              </mat-button-toggle-group>
            </div>
            <div>
              <div>Select framerate:</div>
              <mat-button-toggle-group name="fontStyle" aria-label="Font Style" formControlName="conversionFrameRate">
                <mat-button-toggle *ngFor="let rate of frameRates" [value]="rate"> {{ rate }} fps </mat-button-toggle>
              </mat-button-toggle-group>
            </div>
            <div *ngIf="(converting$ | async) && !convertedURL">
              <div>Converting the image...</div>
              <mat-progress-bar mode="query"></mat-progress-bar>
            </div>
            <button type="button" (click)="onSubmit()" *ngIf="uploadedFile" mat-raised-button color="primary">
              Convert to GIF
            </button>
            <div *ngIf="convertedURL">
              <label>Converted file:</label>
              <div>
                <div>
                  <img [src]="convertedURL" height="150px" width="auto" />
                  <h2><label>Size:</label> {{ convertedSizeInKB }} KB ({{ convertedSizeInMB }} MB)</h2>
                  <div>
                    Tags: <span *ngFor="let tag of tags" (click)="changeCategory(tag)">{{ tag }}</span>
                  </div>
                  <div><strong>Category:</strong>{{ category }}</div>
                </div>
                <div>
                  <input matInput type="text" placeholder="Add tags" [formControl]="tagsControl" />
                  <button type="button" (click)="addTag()">Add tag</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button
          *ngIf="(loadedVideo$ | async)"
          type="button"
          mat-raised-button
          color="primary"
          [disabled]="!convertedFile"
          (click)="onUploadClick()"
        >
          Upload
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
