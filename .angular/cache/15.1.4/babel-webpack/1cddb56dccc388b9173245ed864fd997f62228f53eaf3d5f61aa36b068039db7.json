{"ast":null,"code":"import { ActivatedRoute } from '@angular/router';\nimport { HttpClient, HttpEventType, HttpHeaders, HttpRequest } from '@angular/common/http';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { isEmpty } from 'lodash';\nimport { MainService } from '../../shared/services/main.service';\nimport { Subscription } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../shared/services/main.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@angular/platform-browser\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/card\";\nimport * as i7 from \"../../shared/components/loading-indicator/loading-indicator.component\";\nfunction ImageDetailComponent_mat_card_title_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card-title\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.image.title);\n  }\n}\nfunction ImageDetailComponent_app_loading_indicator_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loading-indicator\");\n  }\n}\nfunction ImageDetailComponent_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"div\");\n    i0.ɵɵelement(2, \"img\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\")(4, \"div\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", ctx_r3.originalImageUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Rating: \", ctx_r3.image.rating, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Score: \", ctx_r3.image._score, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Username: \", ctx_r3.image.username, \"\");\n  }\n}\nexport class ImageDetailComponent {\n  constructor(mainService, route, http, sanitizer) {\n    this.mainService = mainService;\n    this.route = route;\n    this.http = http;\n    this.sanitizer = sanitizer;\n    this.subscriptions = new Subscription();\n  }\n  ngOnInit() {\n    this.subscribeToLibrary();\n  }\n  subscribeToLibrary() {\n    if (isEmpty(this.mainService.getLibrary())) {\n      const librarySub = this.mainService.libraryUpdate.subscribe(() => {\n        this.libraryLoaded = true;\n        this.subscribeRouteParams();\n      });\n      this.subscriptions.add(librarySub);\n    } else {\n      this.subscribeRouteParams();\n    }\n  }\n  ngOnDestroy() {\n    this.subscriptions.unsubscribe();\n  }\n  convertArrBufferToSafeUrl(arrBuffer) {\n    const blob = new Blob([new Uint8Array(arrBuffer)]);\n    const urlCreator = window.URL;\n    const safeUrl = this.sanitizer.bypassSecurityTrustResourceUrl(urlCreator.createObjectURL(blob));\n    return safeUrl;\n  }\n  setImage() {\n    const headers = new HttpHeaders({\n      Accept: 'image/gif'\n    });\n    //TODO: Cancel old http request when old is in progress and want to shoot a new one\n    const options = {\n      headers,\n      reportProgress: true,\n      responseType: 'arraybuffer'\n    };\n    const req = new HttpRequest('GET', this.image.images.original.url, options);\n    // const req = new HttpRequest('GET', 'https://media.giphy.com/media/O5AZJzYhCr1NS/source.gif', options);\n    this.http.request(req).subscribe(event => {\n      if (event.type === HttpEventType.DownloadProgress) {\n        this.mainService.progress.next(Math.floor(event.loaded / event.total * 100));\n      }\n      if (event.type === HttpEventType.Response) {\n        this.originalImageUrl = this.convertArrBufferToSafeUrl(event.body);\n      }\n    });\n  }\n  getImage() {\n    this.originalImageUrl = null;\n    this.image = this.mainService.getImage(this.category, this.id);\n    this.setImage();\n  }\n  subscribeRouteParams() {\n    this.route.paramMap.subscribe(paramMap => {\n      const category = paramMap.get('category');\n      const id = Number(paramMap.get('id'));\n      this.category = category;\n      this.id = +id;\n      this.getImage();\n    });\n  }\n}\nImageDetailComponent.ɵfac = function ImageDetailComponent_Factory(t) {\n  return new (t || ImageDetailComponent)(i0.ɵɵdirectiveInject(i1.MainService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i4.DomSanitizer));\n};\nImageDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ImageDetailComponent,\n  selectors: [[\"app-image-detail\"]],\n  decls: 11,\n  vars: 4,\n  consts: [[\"appearance\", \"outlined\"], [4, \"ngIf\"], [4, \"ngIf\", \"ngIfElse\"], [\"imgTmpl\", \"\"], [1, \"Details\"], [3, \"src\"]],\n  template: function ImageDetailComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"mat-card\", 0)(1, \"mat-card-header\");\n      i0.ɵɵtemplate(2, ImageDetailComponent_mat_card_title_2_Template, 2, 1, \"mat-card-title\", 1);\n      i0.ɵɵelementStart(3, \"mat-card-subtitle\");\n      i0.ɵɵtext(4, \"Category: \");\n      i0.ɵɵelementStart(5, \"strong\");\n      i0.ɵɵtext(6);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(7, \"mat-card-content\");\n      i0.ɵɵtemplate(8, ImageDetailComponent_app_loading_indicator_8_Template, 1, 0, \"app-loading-indicator\", 2);\n      i0.ɵɵtemplate(9, ImageDetailComponent_ng_template_9_Template, 10, 4, \"ng-template\", null, 3, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      const _r2 = i0.ɵɵreference(10);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.image);\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(ctx.category);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", !ctx.originalImageUrl)(\"ngIfElse\", _r2);\n    }\n  },\n  dependencies: [i5.NgIf, i6.MatCard, i6.MatCardContent, i6.MatCardHeader, i6.MatCardSubtitle, i6.MatCardTitle, i7.LoadingIndicatorComponent],\n  styles: [\".ldBar-label{text-align:center;margin-top:-65%;font-size:300%;font-weight:bolder;left:30%;color:#fff;text-shadow:4px 3px 0px black}  .ldBar-label:after{color:inherit;content:\\\"%\\\"}.Details[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;gap:20px;justify-content:center;align-items:center}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}